/*!
 * MockJax - jQuery Plugin to Mock Ajax requests
 *
 * Version:  1.4.0
 * Released: 2011-02-04
 * Source:   http://github.com/appendto/jquery-mockjax
 * Docs:     http://enterprisejquery.com/2010/07/mock-your-ajax-requests-with-mockjax-for-rapid-development
 * Plugin:   mockjax
 * Author:   Jonathan Sharp (http://jdsharp.com)
 * License:  MIT,GPL
 * 
 * Copyright (c) 2010 appendTo LLC.
 * Dual licensed under the MIT or GPL licenses.
 * http://appendto.com/open-source-licenses
 */(function(a){function d(b){window.DOMParser==undefined&&window.ActiveXObject&&(DOMParser=function(){},DOMParser.prototype.parseFromString=function(a){var b=new ActiveXObject("Microsoft.XMLDOM");b.async="false",b.loadXML(a);return b});try{var c=(new DOMParser).parseFromString(b,"text/xml");if(!a.isXMLDoc(c))throw"Unable to parse XML";var d=a("parsererror",c);if(d.length==1)throw"Error: "+a(c).text()}catch(e){var f=e.name==undefined?e:e.name+": "+e.message;a(document).trigger("xmlParseError",[f]);return undefined}return c}var b=a.ajax,c=[];a.extend({ajax:function(e){var f=jQuery.extend(!0,{},jQuery.ajaxSettings,e),g=!1;a.each(c,function(h,i){if(!!c[h]){var j=null;if(a.isFunction(c[h]))j=c[h](f);else{j=c[h];if(a.isFunction(j.url.test))j.url.test(f.url)||(j=null);else{var k=j.url.indexOf("*");if(j.url!="*"&&j.url!=f.url&&k==-1||k>-1&&j.url.substr(0,k)!=f.url.substr(0,k))j=null}if(j){if(j.data&&f.data){var l=!1;(function x(b,c){if(typeof c=="string"){l=a.isFunction(b.test)?b.test(c):b==c;return l}a.each(b,function(d,e){if(c[d]===undefined){l=!1;return!1}l=!0;if(typeof c[d]=="object")return x(b[d],c[d]);a.isFunction(b[d].test)?l=b[d].test(c[d]):l=b[d]==c[d];return l})})(j.data,f.data),l==!1&&(j=null)}j&&j.type&&j.type!=f.type&&(j=null)}}if(j){g=!0;var m=a.extend({},a.mockjaxSettings,j);m.log&&a.isFunction(m.log)&&m.log("MOCK "+f.type.toUpperCase()+": "+f.url,a.extend({},f));var n=/=\?(&|$)/,o=(new Date).getTime();if(f.dataType==="jsonp"){if(f.type.toUpperCase()==="GET")n.test(f.url)||(f.url+=(rquery.test(f.url)?"&":"?")+(f.jsonp||"callback")+"=?");else if(!f.data||!n.test(f.data))f.data=(f.data?f.data+"&":"")+(f.jsonp||"callback")+"=?";f.dataType="json"}f.dataType==="json"&&(f.data&&n.test(f.data)||n.test(f.url))&&(jsonp=f.jsonpCallback||"jsonp"+o++,f.data&&(f.data=(f.data+"").replace(n,"="+jsonp+"$1")),f.url=f.url.replace(n,"="+jsonp+"$1"),f.dataType="script",window[jsonp]=window[jsonp]||function(a){data=a,u(),v(),window[jsonp]=undefined;try{delete window[jsonp]}catch(b){}head&&head.removeChild(script)});var p=/^(\w+:)?\/\/([^\/?#]+)/,q=p.exec(f.url),r=q&&(q[1]&&q[1]!==location.protocol||q[2]!==location.host);if(f.dataType==="script"&&f.type.toUpperCase()==="GET"&&r){var t=e&&e.context||f;function u(){f.success&&f.success.call(t,j.response?j.response.toString():j.responseText||"",status,{}),f.global&&w("ajaxSuccess",[{},f])}function v(){f.complete&&f.complete.call(t,{},status),f.global&&w("ajaxComplete",[{},f]),f.global&&!--jQuery.active&&jQuery.event.trigger("ajaxStop")}function w(a,b){(f.context?jQuery(f.context):jQuery.event).trigger(a,b)}j.response&&a.isFunction(j.response)?j.response(e):a.globalEval(j.responseText),u(),v();return!1}g=b.call(a,a.extend(!0,{},e,{xhr:function(){j=a.extend({},a.mockjaxSettings,j),j.contentType&&(j.headers["content-type"]=j.contentType);return{status:j.status,readyState:1,open:function(){},send:function(){var c=function(b){return function(){return function(){this.status=j.status,this.readyState=4,a.isFunction(j.response)&&j.response(e),f.dataType=="json"&&typeof j.responseText=="object"?this.responseText=JSON.stringify(j.responseText):f.dataType=="xml"?typeof j.responseXML=="string"?this.responseXML=d(j.responseXML):this.responseXML=j.responseXML:this.responseText=j.responseText,a.isFunction(this.onreadystatechange)&&this.onreadystatechange(j.isTimeout?"timeout":undefined)}.apply(b)}}(this);j.proxy?b({global:!1,url:j.proxy,type:j.proxyType,data:j.data,dataType:f.dataType,complete:function(a,b){j.responseXML=a.responseXML,j.responseText=a.responseText,this.responseTimer=setTimeout(c,j.responseTime||0)}}):f.async===!1?c():this.responseTimer=setTimeout(c,j.responseTime||50)},abort:function(){clearTimeout(this.responseTimer)},setRequestHeader:function(){},getResponseHeader:function(a){if(j.headers&&j.headers[a])return j.headers[a];if(a.toLowerCase()=="last-modified")return j.lastModified||(new Date).toString();if(a.toLowerCase()=="etag")return j.etag||"";if(a.toLowerCase()=="content-type")return j.contentType||"text/plain"},getAllResponseHeaders:function(){var b="";a.each(j.headers,function(a,c){b+=a+": "+c+"\n"});return b}}}}));return!1}}});return g?g:b.apply(a,arguments)}}),a.mockjaxSettings={log:function(a){window.console&&window.console.log&&window.console.log(a)},status:200,responseTime:500,isTimeout:!1,contentType:"text/plain",response:"",responseText:"",responseXML:"",proxy:"",proxyType:"GET",lastModified:null,etag:"",headers:{etag:"IJF@H#@923uf8023hFO@I#H#","content-type":"text/plain"}},a.mockjax=function(a){var b=c.length;c[b]=a;return b},a.mockjaxClear=function(a){arguments.length==1?c[a]=null:c=[]}})(jQuery)